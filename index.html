<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>COPA WIOG ‚Äì Grupos y Resultados</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f4f8;
      padding: 40px;
      text-align: center;
    }
    h1 {
      color: #0077cc;
    }
    input, textarea, button {
      margin: 10px;
      padding: 10px;
      font-size: 16px;
    }
    .grupo {
      margin: 20px;
      padding: 15px;
      background: #fff;
      border: 1px solid #ccc;
      width: 300px;
      display: inline-block;
      text-align: left;
      vertical-align: top;
    }
    .grupo h3 {
      margin-top: 0;
      color: #0077cc;
    }
    .partido {
      margin: 10px 0;
    }
    .partido input {
      width: 40px;
      text-align: center;
    }
    .tabla {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 14px;
    }
    .tabla th, .tabla td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }
    .tabla th {
      background-color: #0077cc;
      color: white;
    }
    #equiposLista {
      margin-top: 20px;
      font-weight: bold;
    }
    .grupos-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
    }
  </style>
</head>
<body>

  <h1>üèÜ COPA WIOG ‚Äì Sorteo y Resultados üèÜ</h1>

  <div>
    <input type="text" id="equipoInput" placeholder="Agregar equipo individual" />
    <button onclick="agregarEquipo()">Agregar</button>
  </div>

  <div>
    <textarea id="listaEquipos" rows="6" cols="40" placeholder="Pega aqu√≠ una lista de equipos (uno por l√≠nea)"></textarea><br>
    <button onclick="agregarLista()">Agregar Lista</button>
  </div>

  <div id="equiposLista"></div>

  <button onclick="sortearGrupos()">üé≤ Sortear Grupos</button>

  <div id="gruposResultado" class="grupos-container"></div>

  <script>
    let equipos = [];

    function agregarEquipo() {
      const input = document.getElementById('equipoInput');
      const nombre = input.value.trim();
      if (nombre && !equipos.includes(nombre)) {
        equipos.push(nombre);
        input.value = '';
        mostrarEquipos();
      }
    }

    function agregarLista() {
      const lista = document.getElementById('listaEquipos').value.trim();
      if (lista) {
        const nuevos = lista.split('\n').map(e => e.trim()).filter(e => e && !equipos.includes(e));
        equipos = equipos.concat(nuevos);
        document.getElementById('listaEquipos').value = '';
        mostrarEquipos();
      }
    }

    function mostrarEquipos() {
      document.getElementById('equiposLista').innerText = `Equipos agregados (${equipos.length}): ${equipos.join(', ')}`;
    }

    function sortearGrupos() {
      if (equipos.length !== 32) {
        alert("Debes agregar exactamente 32 equipos para sortear.");
        return;
      }

      const mezclados = equipos.slice().sort(() => Math.random() - 0.5);
      const letras = 'ABCDEFGH'.split('');
      const grupos = {};
      letras.forEach((letra, i) => {
        grupos[letra] = mezclados.slice(i * 4, (i + 1) * 4);
      });

      mostrarGruposYPartidos(grupos);
    }

    function mostrarGruposYPartidos(grupos) {
      const contenedor = document.getElementById('gruposResultado');
      contenedor.innerHTML = '';

      for (const grupo in grupos) {
        const div = document.createElement('div');
        div.className = 'grupo';

        const equiposGrupo = grupos[grupo];
        const partidos = generarPartidosMundial(equiposGrupo);

        div.innerHTML = `<h3>Grupo ${grupo}</h3><ul>${equiposGrupo.map(e => `<li>${e}</li>`).join('')}</ul><hr><h4>Partidos</h4>`;

        partidos.forEach((p, idx) => {
          const partidoDiv = document.createElement('div');
          partidoDiv.className = 'partido';
          partidoDiv.innerHTML = `
            ${p[0]} 
            <input type="number" min="0" id="g${grupo}${idx}a" placeholder="0" /> 
            - 
            <input type="number" min="0" id="g${grupo}${idx}b" placeholder="0" /> 
            ${p[1]}
          `;
          div.appendChild(partidoDiv);
        });

        div.innerHTML += `<button onclick="mostrarTabla('${grupo}', ${JSON.stringify(equiposGrupo).replace(/"/g, '&quot;')})">Ver Tabla</button><div id="tabla_${grupo}"></div>`;

        contenedor.appendChild(div);
      }
    }

    function generarPartidosMundial(equipos) {
      if (equipos.length !== 4) return [];
      const [A, B, C, D] = equipos;
      return [
        [A, B],
        [C, D],
        [A, C],
        [B, D],
        [A, D],
        [B, C]
      ];
    }

    function mostrarTabla(grupo, equiposGrupo) {
      const partidos = generarPartidosMundial(equiposGrupo);
      const stats = {};
      equiposGrupo.forEach(e => stats[e] = {PJ:0, PG:0, PE:0, PP:0, GF:0, GC:0, DG:0, Puntos:0});

      partidos.forEach((p, idx) => {
        const g1 = parseInt(document.getElementById(`g${grupo}${idx}a`).value);
        const g2 = parseInt(document.getElementById(`g${grupo}${idx}b`).value);
        if (isNaN(g1) || isNaN(g2)) return;

        const [eq1, eq2] = p;
        stats[eq1].PJ++; stats[eq2].PJ++;
        stats[eq1].GF += g1; stats[eq1].GC += g2;
        stats[eq2].GF += g2; stats[eq2].GC += g1;

        if (g1 > g2) {
          stats[eq1].PG++; stats[eq2].PP++;
          stats[eq1].Puntos += 3;
        } else if (g1 < g2) {
          stats[eq2].PG++; stats[eq1].PP++;
          stats[eq2].Puntos += 3;
        } else {
          stats[eq1].PE++; stats[eq2].PE++;
          stats[eq1].Puntos += 1;
          stats[eq2].Puntos += 1;
        }
      });

      equiposGrupo.forEach(e => {
        stats[e].DG = stats[e].GF - stats[e].GC;
      });

      const tablaOrdenada = equiposGrupo.map(e => ({Equipo: e, ...stats[e]}))
        .sort((a, b) =>
          b.Puntos - a.Puntos ||
          b.DG - a.DG ||
          b.GF - a.GF
        );

      let tablaHTML = `<table class="tabla">
        <tr><th>Equipo</th><th>PJ</th><th>PG</th><th>PE</th><th>PP</th><th>GF</th><th>GC</th><th>DG</th><th>Pts</th></tr>`;
      tablaOrdenada.forEach(t => {
        tablaHTML += `<tr>
          <td>${t.Equipo}</td>
          <td>${t.PJ}</td><td>${t.PG}</td><td>${t.PE}</td><td>${t.PP}</td>
          <td>${t.GF}</td><td>${t.GC}</td><td>${t.DG}</td><td>${t.Puntos}</td>
        </tr>`;
      });
      tablaHTML += '</table>';

      document.getElementById(`tabla_${grupo}`).innerHTML = tablaHTML;
    }
  </script>

</body>
</html>
