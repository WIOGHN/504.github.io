<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Champions League WIOG ‚Äî Rebuild</title>
<style>
  :root { --bg:#0b1020; --card:#111835; --text:#e9ecf1; --accent:#ffd24d; --muted:#93a1b1; }
  body{background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,sans-serif; margin:0; padding:24px;}
  h1,h2,h3,h4{margin:6px 0 10px}
  .wrap{max-width:1180px; margin:0 auto;}
  .row{display:grid; grid-template-columns:1fr 1fr; gap:14px;}
  .card{background:var(--card); border:1px solid #1f2b55; padding:12px; border-radius:12px; box-shadow:0 4px 16px rgba(0,0,0,.25);}
  textarea{width:100%; min-height:140px; border-radius:8px; border:1px solid #334; background:#fff; color:#000; padding:8px; font-family:inherit}
  button{background:#1e2a56; color:#fff; border:1px solid #2b3d7a; border-radius:10px; padding:8px 12px; cursor:pointer; font-weight:700}
  button:hover{filter:brightness(1.1)}
  .notice{color:var(--muted); font-size:13px}
  .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:10px}
  .pill{display:inline-block; background:#0f1a3b; border:1px solid #2b3d7a; padding:6px 8px; border-radius:999px; margin:2px 4px}
  table{width:100%; border-collapse:collapse; background:#fff; color:#000; border-radius:10px; overflow:hidden}
  th,td{border:1px solid #444; padding:6px}
  th{background:var(--accent)}
  input[type=number]{width:56px}
  .section-title{display:flex; align-items:center; gap:8px}
  .round{margin:12px 0}
  .bracket{display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:10px}
  .tie{display:flex; flex-direction:column; gap:6px; background:#0f1733; border:1px solid #2b3d7a; padding:10px; border-radius:10px}
  .leg{background:#fff; color:#000; padding:6px; border-radius:6px}
  .agg{font-weight:700; background:#fffbe6; color:#111; border:1px solid var(--accent); border-radius:6px; padding:6px}
  .ok{color:#6ee7b7; font-weight:700}
  .warn{color:#ffeb3b; font-weight:700}
</style>
</head>
<body>
<div class="wrap">
  <h1>üèüÔ∏è Champions League WIOG ‚Äî Proyecto reconstruido</h1>

  <div class="row">
    <div class="card">
      <div class="section-title"><h2>üë• Agregar 36 Jugadores</h2></div>
      <textarea id="jug-in" placeholder="Un jugador por l√≠nea (36 en total)"></textarea>
      <div style="display:flex; gap:8px; align-items:center; margin-top:8px;">
        <button id="btn-add-jug">Agregar lista de jugadores</button>
        <span id="jug-estado" class="notice">0/36</span>
      </div>
    </div>

    <div class="card">
      <div class="section-title"><h2>üè≥Ô∏è Agregar 36 Equipos</h2></div>
      <textarea id="eq-in" placeholder="Un equipo por l√≠nea (36 en total)"></textarea>
      <div style="display:flex; gap:8px; align-items:center; margin-top:8px;">
        <button id="btn-add-eq">Agregar lista de equipos</button>
        <span id="eq-estado" class="notice">0/36</span>
      </div>
    </div>
  </div>

  <div class="card" style="margin-top:14px;">
    <div style="display:flex; gap:10px; flex-wrap:wrap;">
      <button id="btn-sort">üé≤ Sortear Parejas (Jugador ‚áÑ Equipo)</button>
      <button id="btn-fase">üìÖ Generar Fase de Liga (36 equipos, 8 jornadas)</button>
      <button id="btn-stand">üìä Generar/Actualizar Tabla</button>
      <button id="btn-playin">üéüÔ∏è Generar Play‚Äëin (9‚Äì24)</button>
      <button id="btn-octavos">üèÜ Generar Octavos</button>
      <button id="btn-reset">‚ôªÔ∏è Reset</button>
    </div>
    <div class="notice" style="margin-top:6px">Flujo recomendado: agregar listas ‚Üí sortear parejas ‚Üí generar fase ‚Üí cargar resultados ‚Üí actualizar tabla ‚Üí play‚Äëin ‚Üí octavos.</div>
  </div>

  <div id="parejas" class="card" style="margin-top:12px;">
    <h3>üîó Parejas sorteadas</h3>
    <div id="parejas-grid" class="grid"></div>
  </div>

  <div id="fixtures" class="card" style="margin-top:12px;">
    <h3>üìÖ Fase de Liga ‚Äî 8 jornadas</h3>
    <div id="jornadas"></div>
  </div>

  <div id="standings" class="card" style="margin-top:12px;">
    <h3>üìä Tabla estilo Champions</h3>
    <div id="tabla-wrap"></div>
  </div>

  <div id="playin" class="card" style="margin-top:12px;">
    <h3>üéüÔ∏è Play‚Äëin (puestos 9‚Äì24) ‚Äî Ida y Vuelta</h3>
    <div id="playin-wrap"></div>
  </div>

  <div id="ko" class="card" style="margin-top:12px;">
    <h3>‚öîÔ∏è Eliminatoria</h3>
    <div class="round">
      <h4>Octavos de Final (ida y vuelta)</h4>
      <div id="octavos" class="bracket"></div>
    </div>
    <div class="round">
      <h4>Cuartos de Final (ida y vuelta)</h4>
      <div id="cuartos" class="bracket"></div>
    </div>
    <div class="round">
      <h4>Semifinales (ida y vuelta)</h4>
      <div id="semis" class="bracket"></div>
    </div>
    <div class="round">
      <h4>Gran Final (partido √∫nico)</h4>
      <div id="final" class="bracket"></div>
    </div>
  </div>
</div>

<script>
// ====== Estado global ======
let JUG = [], EQ = [], PAREJAS = [], JORNADAS = [], TABLA = [];
const rnd = a => a.sort(()=>Math.random()-0.5);
const norm = t => (t||'').split('\n').map(s=>s.trim()).filter(Boolean);
const uniq = arr => {const s=new Set(); const out=[]; for (const x of arr){const k=x.toLowerCase(); if(!s.has(k)){s.add(k); out.push(x);} } return out;};

function renderEstados(){
  const ej = document.getElementById('jug-estado');
  const ee = document.getElementById('eq-estado');
  if (ej) ej.innerHTML = `Jugadores: <strong>${JUG.length}</strong>/36 ` + (JUG.length===36?'<span class="ok">OK</span>':`<span class="warn">(faltan ${36-JUG.length})</span>`);
  if (ee) ee.innerHTML = `Equipos: <strong>${EQ.length}</strong>/36 ` + (EQ.length===36?'<span class="ok">OK</span>':`<span class="warn">(faltan ${36-EQ.length})</span>`);
}

// ====== Carga de listas ======
function addJug(){
  const txt = document.getElementById('jug-in'); if(!txt){alert('√Årea de jugadores no encontrada'); return;}
  const lista = uniq(norm(txt.value));
  if (!lista.length){ alert('Ingresa al menos 1 jugador.'); return; }
  JUG = lista;
  renderEstados();
}
function addEq(){
  const txt = document.getElementById('eq-in'); if(!txt){alert('√Årea de equipos no encontrada'); return;}
  const lista = uniq(norm(txt.value));
  if (!lista.length){ alert('Ingresa al menos 1 equipo.'); return; }
  EQ = lista;
  renderEstados();
}

// ====== Sortear parejas ======
function sortearParejas(){
  if (JUG.length!==36 || EQ.length!==36){ alert('Debes tener 36 jugadores y 36 equipos.'); return; }
  const a = rnd([...JUG]); const b = rnd([...EQ]);
  PAREJAS = a.map((jug,i)=>({jugador:jug, equipo:b[i]}));
  const grid = document.getElementById('parejas-grid'); grid.innerHTML='';
  PAREJAS.forEach(p=>{
    const d = document.createElement('div'); d.className='pill';
    d.innerHTML = `<strong>${p.jugador}</strong> ‚áÑ <span style="color:${getComputedStyle(document.documentElement).getPropertyValue('--accent')}; font-weight:700">${p.equipo}</span>`;
    grid.appendChild(d);
  });
}

// ====== Generar fase liga (8 jornadas, sin rivales repetidos) ======
function generarFase(){
  if (PAREJAS.length!==36){ alert('Primero sortea las parejas.'); return; }
  const teams = PAREJAS.map(p=>p.equipo);
  const matchups = new Map(teams.map(t=>[t,new Set()]));
  const homeCnt = new Map(teams.map(t=>[t,0]));
  const jornadas=[];

  function intentarRonda(){
    const disp = rnd([...teams]); const res=[];
    while(disp.length){
      const a=disp.shift(); let ok=false;
      for (let i=0;i<disp.length;i++){
        const b=disp[i];
        if (!matchups.get(a).has(b)){
          res.push([a,b]);
          matchups.get(a).add(b); matchups.get(b).add(a);
          disp.splice(i,1); ok=true; break;
        }
      }
      if (!ok){
        res.forEach(([x,y])=>{ matchups.get(x).delete(y); matchups.get(y).delete(x); });
        return null;
      }
    }
    // balance local/visitante
    return res.map(([h,aw])=>{
      const hc=homeCnt.get(h), ac=homeCnt.get(aw);
      if (hc-ac>0){ homeCnt.set(aw, ac+1); return [aw,h]; }
      homeCnt.set(h, hc+1); return [h,aw];
    });
  }

  for (let r=0;r<8;r++){
    let ronda=null, intentos=0;
    while(!ronda && intentos<2000){ intentos++; ronda=intentarRonda(); }
    if (!ronda){
      // reiniciar desde cero si no se consigue
      teams.forEach(t=>{ matchups.get(t).clear(); homeCnt.set(t,0); });
      jornadas.length=0; r=-1; continue;
    }
    jornadas.push(ronda);
  }

  JORNADAS = jornadas;
  renderJornadas();
}

function renderJornadas(){
  const cont = document.getElementById('jornadas'); cont.innerHTML='';
  const mapJ = new Map(PAREJAS.map(p=>[p.equipo,p.jugador]));
  JORNADAS.forEach((pairs,idx)=>{
    const rd = document.createElement('div'); rd.className='round';
    rd.innerHTML = `<h4>Jornada ${idx+1}</h4>`;
    const table = document.createElement('table');
    table.innerHTML = '<thead><tr><th>Local</th><th>Visitante</th><th>Jugador (Local)</th><th>Jugador (Visitante)</th></tr></thead>';
    const tb = document.createElement('tbody');
    pairs.forEach((pair,m)=>{
      const [home,away] = pair; const jl=mapJ.get(home)||'', jv=mapJ.get(away)||'';
      const ida=`r${idx+1}-m${m}-a`, idb=`r${idx+1}-m${m}-b`;
      const tr=document.createElement('tr');
      tr.innerHTML = `<td>${home}<br/><input type="number" min="0" id="${ida}"></td>`+
                     `<td>${away}<br/><input type="number" min="0" id="${idb}"></td>`+
                     `<td>${jl}</td><td>${jv}</td>`;
      tb.appendChild(tr);
    });
    table.appendChild(tb); rd.appendChild(table); cont.appendChild(rd);
  });
}

// ====== Tabla estilo Champions ======
function actualizarTabla(){
  if (!PAREJAS.length || !JORNADAS.length){ alert('Genera parejas y fase de liga primero.'); return; }
  const stats = {}; PAREJAS.forEach(p=> stats[p.equipo]={Equipo:p.equipo, Jugador:p.jugador, PJ:0,G:0,E:0,P:0,GF:0,GC:0,DG:0,Pts:0});

  JORNADAS.forEach((pairs, rIdx)=>{
    pairs.forEach((pair, mIdx)=>{
      const [home,away] = pair;
      const a = parseInt((document.getElementById(`r${rIdx+1}-m${mIdx}-a`)||{}).value);
      const b = parseInt((document.getElementById(`r${rIdx+1}-m${mIdx}-b`)||{}).value);
      if (Number.isNaN(a) || Number.isNaN(b)) return;
      stats[home].PJ++; stats[away].PJ++;
      stats[home].GF+=a; stats[home].GC+=b;
      stats[away].GF+=b; stats[away].GC+=a;
      if (a>b){ stats[home].G++; stats[away].P++; stats[home].Pts+=3; }
      else if (a<b){ stats[away].G++; stats[home].P++; stats[away].Pts+=3; }
      else { stats[home].E++; stats[away].E++; stats[home].Pts++; stats[away].Pts++; }
    });
  });
  Object.values(stats).forEach(s=>s.DG=s.GF-s.GC);
  TABLA = Object.values(stats).sort((a,b)=> b.Pts-a.Pts || b.DG-a.DG || b.GF-a.GF || a.Equipo.localeCompare(b.Equipo));
  renderTabla();
}

function renderTabla(){
  const cont = document.getElementById('tabla-wrap'); cont.innerHTML='';
  const mk = (rows,start,label)=>{
    const t=document.createElement('table');
    t.innerHTML='<thead><tr><th>#</th><th>Equipo</th><th>Jugador</th><th>PJ</th><th>G</th><th>E</th><th>P</th><th>GF</th><th>GC</th><th>DG</th><th>Pts</th></tr></thead>';
    const tb=document.createElement('tbody');
    rows.forEach((r,i)=>{
      const tr=document.createElement('tr');
      tr.innerHTML = `<td>${start+i}</td><td>${r.Equipo}</td><td>${r.Jugador}</td><td>${r.PJ}</td><td>${r.G}</td><td>${r.E}</td><td>${r.P}</td><td>${r.GF}</td><td>${r.GC}</td><td>${r.DG}</td><td><strong>${r.Pts}</strong></td>`;
      tb.appendChild(tr);
    });
    t.appendChild(tb);
    const box=document.createElement('div'); box.className='round'; box.innerHTML=`<h4>${label}</h4>`; box.appendChild(t); return box;
  };
  cont.appendChild(mk(TABLA.slice(0,8),1,'1‚Äì8 Clasificaci√≥n directa'));
  cont.appendChild(mk(TABLA.slice(8,24),9,'9‚Äì24 Play‚Äëin'));
  cont.appendChild(mk(TABLA.slice(24,36),25,'25‚Äì36 Eliminados'));
}

// ====== Play-in (Ida/Vuelta) ======
function generarPlayin(){
  if (!TABLA.length){ alert('Actualiza la tabla primero.'); return; }
  const A = TABLA.slice(8,16).map(r=>r.Equipo);   // 9‚Äì16 cabezas
  const B = TABLA.slice(16,24).map(r=>r.Equipo);  // 17‚Äì24 no cabezas
  const cont = document.getElementById('playin-wrap'); cont.innerHTML='';
  const table = document.createElement('table');
  table.className='cl-playin-table';
  table.innerHTML='<thead><tr><th>Emparejamiento</th><th>Ida</th><th>Vuelta</th><th>Global</th><th>Ganador</th></tr></thead>';
  const tb=document.createElement('tbody');
  for (let i=0;i<8;i++){
    const seeded=A[i], unseed=B[7-i];
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${seeded} (cabeza) vs ${unseed}</td>`+
      `<td>${unseed} <input type="number" min="0" id="pl${i}-ida-a"> ‚Äì <input type="number" min="0" id="pl${i}-ida-b"> ${seeded}</td>`+
      `<td>${seeded} <input type="number" min="0" id="pl${i}-vta-a"> ‚Äì <input type="number" min="0" id="pl${i}-vta-b"> ${unseed}</td>`+
      `<td id="pl${i}-global">‚Äî</td><td id="pl${i}-win">‚Äî</td>`;
    tb.appendChild(tr);
  }
  table.appendChild(tb); cont.appendChild(table);

  // listeners por cruce
  for (let i=0;i<8;i++){
    const seeded=A[i], unseed=B[7-i];
    const idaA = document.getElementById(`pl${i}-ida-a`);
    const idaB = document.getElementById(`pl${i}-ida-b`);
    const vtaA = document.getElementById(`pl${i}-vta-a`);
    const vtaB = document.getElementById(`pl${i}-vta-b`);
    const out  = document.getElementById(`pl${i}-global`);
    const win  = document.getElementById(`pl${i}-win`);
    const recalc = () => {
      const a1=parseInt(idaA.value), b1=parseInt(idaB.value), a2=parseInt(vtaA.value), b2=parseInt(vtaB.value);
      if ([a1,b1,a2,b2].some(Number.isNaN)){ out.textContent='‚Äî'; win.textContent='‚Äî'; return; }
      const golesSeeded = b1 + a2;
      const golesUnseed = a1 + b2;
      out.textContent = `${golesSeeded}‚Äì${golesUnseed}`;
      if (golesSeeded>golesUnseed) win.textContent=seeded;
      else if (golesSeeded<golesUnseed) win.textContent=unseed;
      else { const pen = prompt(`Empate ${seeded} vs ${unseed}. Ganador por penales:`); win.textContent = pen || '‚Äî'; }
    };
    [idaA,idaB,vtaA,vtaB].forEach(el=> el.addEventListener('input', recalc));
  }
}

// ====== KO (Octavos‚ÜíFinal) con auto‚Äëavance incremental ======
function makeTie(container, prefix, n){
  container.innerHTML='';
  for (let i=0;i<n;i++){
    const tie = document.createElement('div'); tie.className='tie'; tie.id = `${prefix}-t${i}`;
    const l1 = document.createElement('div'); l1.className='leg'; l1.innerHTML = `Ida: <span class="cl-home">‚Äî</span> <input type="number" min="0" id="${prefix}-t${i}-ida-a"> ‚Äì <input type="number" min="0" id="${prefix}-t${i}-ida-b"> <span class="cl-away">‚Äî</span>`;
    const l2 = document.createElement('div'); l2.className='leg'; l2.innerHTML = `Vuelta: <span class="cl-away">‚Äî</span> <input type="number" min="0" id="${prefix}-t${i}-vta-a"> ‚Äì <input type="number" min="0" id="${prefix}-t${i}-vta-b"> <span class="cl-home">‚Äî</span>`;
    const ag = document.createElement('div'); ag.className='agg'; ag.innerHTML = `Global: <span id="${prefix}-t${i}-global">‚Äî</span> &nbsp; Ganador: <span id="${prefix}-t${i}-win">‚Äî</span>`;
    tie.appendChild(l1); tie.appendChild(l2); tie.appendChild(ag); container.appendChild(tie);
  }
}

function connectTwoLeg(prefix, count, onAll, onPartial){
  const winners = new Array(count).fill('‚Äî');
  for (let i=0;i<count;i++){
    const tieId = `${prefix}-t${i}`;
    const idaA = document.getElementById(`${tieId}-ida-a`);
    const idaB = document.getElementById(`${tieId}-ida-b`);
    const vtaA = document.getElementById(`${tieId}-vta-a`);
    const vtaB = document.getElementById(`${tieId}-vta-b`);
    const g    = document.getElementById(`${tieId}-global`);
    const w    = document.getElementById(`${tieId}-win`);
    const home = document.querySelectorAll(`#${tieId} .cl-home`);
    const away = document.querySelectorAll(`#${tieId} .cl-away`);

    const recalc = () => {
      const a1 = parseInt(idaA.value), b1 = parseInt(idaB.value), a2 = parseInt(vtaA.value), b2 = parseInt(vtaB.value);
      if ([a1,b1,a2,b2].some(Number.isNaN)){ g.textContent='‚Äî'; w.textContent='‚Äî'; winners[i]='‚Äî'; return; }
      const teamHomeIda = home[0].textContent, teamAwayIda = away[0].textContent;
      const totalA = a1 + b2, totalB = b1 + a2;
      g.textContent = `${totalA}‚Äì${totalB}`;
      let winTeam = totalA>totalB ? teamHomeIda : totalB>totalA ? teamAwayIda : (prompt(`Empate ${teamHomeIda} vs ${teamAwayIda}. Ganador por penales:`)||'‚Äî');
      w.textContent = winTeam; winners[i]=winTeam;
      if (typeof onPartial==='function') onPartial(i, winTeam);
      if (winners.every(x=>x && x!=='‚Äî')) onAll([...winners]);
    };
    [idaA,idaB,vtaA,vtaB].forEach(el=> el.addEventListener('input', recalc));
  }
}

function generarOctavos(){
  if (!TABLA.length){ alert('Actualiza la tabla primero.'); return; }
  // leer ganadores play-in
  const wins=[]; for (let i=0;i<8;i++){ const el=document.getElementById(`pl${i}-win`); if (!el || el.textContent==='‚Äî'){ alert('Completa ganadores del play‚Äëin.'); return; } wins.push(el.textContent); }
  const top8 = TABLA.slice(0,8).map(r=>r.Equipo);
  const shuffled = rnd([...wins]);
  // construir ties si no existen
  const oct = document.getElementById('octavos'); makeTie(oct, 'octavos', 8);
  const cu = document.getElementById('cuartos'); makeTie(cu, 'cuartos', 4);
  const se = document.getElementById('semis');   makeTie(se, 'semis', 2);
  const fi = document.getElementById('final');   fi.innerHTML=''; const fcard=document.createElement('div'); fcard.className='tie'; fcard.id='final-t0';
  fcard.innerHTML = `Final: <span>‚Äî</span> <input type="number" min="0" id="final-t0-a"> ‚Äì <input type="number" min="0" id="final-t0-b"> <span>‚Äî</span>`; fi.appendChild(fcard);

  // poblar octavos (ida: ganador play-in en casa; vuelta: cabeza en casa)
  for (let i=0;i<8;i++){
    const tie = document.getElementById(`octavos-t${i}`);
    const homes = tie.querySelectorAll('.cl-home');
    const aways = tie.querySelectorAll('.cl-away');
    homes[0].textContent = shuffled[i]; aways[0].textContent = top8[i];
    homes[1].textContent = top8[i];     aways[1].textContent = shuffled[i];
  }

  // encadenar con avance incremental
  connectTwoLeg('octavos', 8, (w8)=>{
    // cuando est√©n todos, rellenar cuartos completamente (por si faltaba alguno)
    for (let i=0;i<4;i++){
      const A=w8[2*i], B=w8[2*i+1]; const tie=document.getElementById(`cuartos-t${i}`);
      const homes=tie.querySelectorAll('.cl-home'), aways=tie.querySelectorAll('.cl-away');
      homes[0].textContent=A; aways[0].textContent=B; homes[1].textContent=B; aways[1].textContent=A;
      ['ida-a','ida-b','vta-a','vta-b'].forEach(s=>{ const el=tie.querySelector(`#cuartos-t${i}-${s}`); if (el) el.value=''; });
      tie.querySelector(`#cuartos-t${i}-global`).textContent='‚Äî'; tie.querySelector(`#cuartos-t${i}-win`).textContent='‚Äî';
    }
    connectTwoLeg('cuartos', 4, (w4)=>{
      for (let i=0;i<2;i++){
        const A=w4[2*i], B=w4[2*i+1]; const tie=document.getElementById(`semis-t${i}`);
        const homes=tie.querySelectorAll('.cl-home'), aways=tie.querySelectorAll('.cl-away');
        homes[0].textContent=A; aways[0].textContent=B; homes[1].textContent=B; aways[1].textContent=A;
        ['ida-a','ida-b','vta-a','vta-b'].forEach(s=>{ const el=tie.querySelector(`#semis-t${i}-${s}`); if (el) el.value=''; });
        tie.querySelector(`#semis-t${i}-global`).textContent='‚Äî'; tie.querySelector(`#semis-t${i}-win`).textContent='‚Äî';
      }
      connectTwoLeg('semis', 2, (w2)=>{
        const sp = document.querySelectorAll('#final-t0 span');
        sp[0].textContent=w2[0]; sp[1].textContent=w2[1];
        document.getElementById('final-t0-a').value=''; document.getElementById('final-t0-b').value='';
      }, (idx, winName)=>{
        const sp = document.querySelectorAll('#final-t0 span');
        if (sp[idx]) sp[idx].textContent = winName;
      });
    }, (idx, winName)=>{
      const s=Math.floor(idx/2), pos=idx%2; const tie=document.getElementById(`semis-t${s}`);
      const homes=tie.querySelectorAll('.cl-home'), aways=tie.querySelectorAll('.cl-away');
      if (pos===0){ homes[0].textContent=winName; homes[1].textContent='‚Äî'; } else { aways[0].textContent=winName; aways[1].textContent='‚Äî'; }
      const A=homes[0].textContent, B=aways[0].textContent; if (A!=='‚Äî' && B!=='‚Äî'){ homes[1].textContent=B; aways[1].textContent=A; }
    });
  }, (idx, winName)=>{
    const q=Math.floor(idx/2), pos=idx%2; const tie=document.getElementById(`cuartos-t${q}`);
    const homes=tie.querySelectorAll('.cl-home'), aways=tie.querySelectorAll('.cl-away');
    if (pos===0){ homes[0].textContent=winName; homes[1].textContent='‚Äî'; } else { aways[0].textContent=winName; aways[1].textContent='‚Äî'; }
    const A=homes[0].textContent, B=aways[0].textContent; if (A!=='‚Äî' && B!=='‚Äî'){ homes[1].textContent=B; aways[1].textContent=A; }
  });
}

// ====== Reset ======
function resetAll(){
  JUG=[]; EQ=[]; PAREJAS=[]; JORNADAS=[]; TABLA=[];
  document.getElementById('jug-in').value='';
  document.getElementById('eq-in').value='';
  document.getElementById('parejas-grid').innerHTML='';
  document.getElementById('jornadas').innerHTML='';
  document.getElementById('tabla-wrap').innerHTML='';
  document.getElementById('playin-wrap').innerHTML='';
  document.getElementById('octavos').innerHTML='';
  document.getElementById('cuartos').innerHTML='';
  document.getElementById('semis').innerHTML='';
  document.getElementById('final').innerHTML='';
  renderEstados();
}

// ====== Listeners ======
document.getElementById('btn-add-jug').onclick = addJug;
document.getElementById('btn-add-eq').onclick  = addEq;
document.getElementById('btn-sort').onclick    = sortearParejas;
document.getElementById('btn-fase').onclick    = generarFase;
document.getElementById('btn-stand').onclick   = actualizarTabla;
document.getElementById('btn-playin').onclick  = generarPlayin;
document.getElementById('btn-octavos').onclick = generarOctavos;
document.getElementById('btn-reset').onclick   = resetAll;

</script>
</body>
</html>
