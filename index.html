
<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<title>COPA WIOG – Mundial Completo con Llave Visual</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
    body {
      font-family: 'Poppins', sans-serif;
      background: radial-gradient(circle at top, #0f0f0f 0%, #1a1a1a 100%);
      color: #f1f1f1;
      text-align: center;
      padding: 30px;
      margin: 0;
    }
    h1, h2, h3 {
      color: #ffd700;
      text-shadow: 2px 2px 4px #000;
      margin-bottom: 15px;
    }
    textarea, input, button {
      padding: 10px;
      border-radius: 8px;
      border: none;
      font-size: 14px;
      margin: 5px 0;
      font-family: inherit;
    }
    textarea {
      resize: vertical;
      background-color: #1e1e1e;
      color: #fff;
      border: 1px solid #444;
    }
    input[type="text"], input[type="number"] {
      background-color: #2a2a2a;
      color: #fff;
      border: 1px solid #444;
    }
    button {
      background: linear-gradient(to right, #ffd700, #ffc400);
      color: #000;
      font-weight: 600;
      padding: 10px 16px;
      border-radius: 30px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(255, 215, 0, 0.3);
      border: none;
    }
    button:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 12px rgba(255, 215, 0, 0.5);
    }
    .grupo {
  max-width: 220px;
  font-size: 12px;

      background: #1f1f1f;
      border: 2px solid #ffd700;
      border-radius: 14px;
      padding: 16px;
      margin: 15px;
      width: 270px;
      display: inline-block;
      vertical-align: top;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
      transition: transform 0.3s;
    }
    .grupo:hover {
      transform: translateY(-5px);
    }
    .grupo ul {
      list-style: none;
      padding: 0;
      margin-bottom: 10px;
    }
    .grupo li {
  font-size: 12px;
      padding: 6px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .partido {
  font-size: 11px;
      margin: 6px 0;
      font-size: 13px;
    }
    .tabla {
      margin-top: 10px;
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }
    .tabla th, .tabla td {
  font-size: 11px;
      border: 1px solid #444;
      padding: 6px;
      background: #fff;
      color: #000;
    }
    .bracket {
      display: flex;
      justify-content: center;
      flex-wrap: nowrap;
      gap: 24px;
      overflow-x: auto;
      margin-top: 40px;
      padding: 10px;
    }
    .round {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .match {
      background-color: #fefefe;
      color: #111;
      border-radius: 8px;
      padding: 6px 8px;
      font-weight: 600;
      font-size: 12px;
      min-width: 110px;
      max-width: 130px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      line-height: 1.2;
      transition: transform 0.2s ease;
    }

    .match:hover {
      transform: scale(1.03);
      background-color: #fffbe6;
    }
    .final {
      background: linear-gradient(to right, #ff6f00, #ff9100);
      color: #fff;
    }
    .campeon {
      margin-top: 40px;
      font-size: 28px;
      font-weight: bold;
      color: #00e676;
      text-shadow: 0 0 10px #00e676;
    }
    #equiposAgregados {
      color: #ffeb3b;
      font-size: 14px;
      margin-bottom: 20px;
    }
    ::selection {
      background: #ffd700;
      color: #000;
    }
    @media (max-width: 768px) {
      .grupo {
  max-width: 220px;
  font-size: 12px;
 width: 90%; }
      .bracket { flex-wrap: wrap; gap: 10px; }
      .round { gap: 14px; }
    }
  

    .match.winner {
      background-color: #d4edda !important;
      border: 2px solid #28a745 !important;
      box-shadow: 0 0 8px #28a745;
    }

    .match input {
  width: 14px !important;
  padding: 1px;
  font-size: 11px;
  height: 16px;
  text-align: center;
  line-height: 1;

      background-color: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 4px;
      text-align: center;
      width: 28px;
      font-size: 12px;
    }

    .match button {
      background-color: #ffd700;
      color: #000;
      font-weight: bold;
      padding: 4px 10px;
      border-radius: 16px;
      font-size: 10px;
      margin-top: 4px;
      cursor: pointer;
      transition: 0.2s;
    }

    .match button:hover {
      background-color: #ffc400;
      transform: scale(1.05);
    }
    

    .match input:focus {
      outline: none;
      border-color: #ffd700;
      box-shadow: 0 0 4px #ffd700;
    }

    .match span {
      display: inline-block;
      min-width: 50px;
    }

    .match .score-winner {
      background-color: #d4edda;
      border-color: #28a745;
    }

    .match .score-loser {
      background-color: #f8d7da;
      border-color: #dc3545;
    }
    

    .grupo .partido input {
      width: 52px !important;
      height: 48px;
      font-size: 20px;
      padding: 4px;
      text-align: center;
      margin: 0 4px;
    }
    

    #grupos {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
    }

    .grupo {
      flex: 1 1 calc(33.33% - 40px);
      max-width: 340px;
      min-width: 300px;
      box-sizing: border-box;
    }

    @media (max-width: 900px) {
      .grupo {
        flex: 1 1 calc(50% - 30px);
      }
    }

    @media (max-width: 600px) {
      .grupo {
        flex: 1 1 100%;
      }
    }
    

    #grupos {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 30px;
    }

    .grupo {
      flex: 1 1 calc(50% - 40px);
      max-width: 500px;
      min-width: 400px;
      font-size: 15px;
    }

    .grupo h3 {
      font-size: 20px;
      margin-bottom: 10px;
    }

    .grupo li {
      font-size: 15px;
    }

    .partido {
      font-size: 14px;
    }
    

    .grupo {
      text-align: center;
    }

    .grupo ul {
      padding-left: 0;
    }

    .grupo li {
      text-align: center;
    }

    .partido {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }
    

    .partido input {
      vertical-align: middle;
      display: inline-block;
      text-align: center;
    }

    .partido span {
      display: inline-block;
      min-width: 100px;
      text-align: right;
    }
    

    .partido {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin: 4px 0;
    }

    .partido .team-name {
      min-width: 120px;
      text-align: right;
      font-weight: 500;
    }

    .partido .team-name:last-child {
      text-align: left;
    }

    .partido input {
      width: 36px !important;
      height: 28px;
      font-size: 15px;
    }
    

    .partido {
      display: grid;
      grid-template-columns: 1fr auto auto 1fr;
      align-items: center;
      justify-content: center;
      gap: 6px;
      margin: 6px 0;
    }

    .partido .team-name {
      text-align: right;
      font-weight: 500;
    }

    .partido .team-name:last-child {
      text-align: left;
    }

    .partido input {
      width: 36px !important;
      height: 30px;
      font-size: 15px;
      text-align: center;
    }
    

    .partido .team-name {
      text-align: right;
      font-weight: 500;
      padding-right: 4px;
    }

    .partido .team-name:last-of-type {
      text-align: left;
      padding-left: 4px;
    }
    

    .grupo {
      max-width: 580px;
      min-width: 500px;
    }

    .partido .team-name {
      min-width: 150px;
      font-size: 15px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    

    .partido {
      display: grid;
      grid-template-columns: 1fr auto auto 1fr;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .partido .team-name {
      min-width: 120px;
      white-space: nowrap;
      text-align: center;
      font-size: 15px;
    }

    .partido input {
      width: 38px !important;
      height: 32px;
      font-size: 16px;
      text-align: center;
    }
    

    #grupos {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 30px;
    }

    .grupo {
      flex: 1 1 calc(50% - 40px);
      max-width: 520px;
      min-width: 460px;
    }

    .partido {
      display: grid;
      grid-template-columns: 1fr auto auto auto 1fr;
      align-items: center;
      justify-content: center;
      gap: 6px;
      margin: 5px 0;
    }

    .partido .team-name {
      text-align: center;
      white-space: nowrap;
      font-size: 15px;
    }

    .partido .vs {
      font-weight: bold;
      font-size: 16px;
      color: #ffd700;
      text-shadow: 1px 1px #000;
    }

    .partido input {
      width: 38px !important;
      height: 32px;
      font-size: 16px;
      text-align: center;
    }
    

    .tabla {
      margin-top: 10px;
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      box-shadow: 0 0 10px rgba(0,0,0,0.4);
    }

    .tabla th {
      background-color: #ffd700;
      color: #000;
      padding: 6px;
    }

    .tabla td {
      background-color: #f9f9f9;
      color: #000;
      padding: 6px;
    }

    .tabla tr:nth-child(even) td {
      background-color: #eee;
    }

    .tabla tr:first-child {
      border-top: 2px solid #000;
    }

    .tabla tr.top-team {
      background-color: #b9fbc0 !important;
      font-weight: bold;
    }

    .tabla tr.top-team td {
      background-color: #b9fbc0 !important;
    }
    

    .bracket {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 20px;
      margin-top: 40px;
      flex-wrap: nowrap;
    }

    .round {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 40px;
      min-width: 160px;
    }

    .match {
      background-color: #ffffff;
      color: #000;
      border-radius: 6px;
      padding: 6px 10px;
      font-weight: bold;
      min-width: 140px;
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 6px;
      box-shadow: 0 0 6px rgba(0,0,0,0.3);
    }

    .match input {
      width: 28px;
      height: 26px;
      font-size: 14px;
      text-align: center;
    }

    .campeon {
      margin-top: 30px;
      font-size: 22px;
      color: #00e676;
    }
    
.match input {
  width: 38px !important;
  height: 32px !important;
  font-size: 16px !important;
}

@keyframes glow {
  0% { box-shadow: 0 0 5px 2px #00e676; }
  50% { box-shadow: 0 0 15px 4px #00e676; }
  100% { box-shadow: 0 0 5px 2px #00e676; }
}
.winner-highlight {
  border: 2px solid #00e676 !important;
  animation: glow 1s ease-in-out infinite;
  background-color: #e0ffe8 !important;
}

.match input {
  width: 44px !important;
  height: 36px !important;
  font-size: 18px !important;
  text-align: center;
  font-weight: bold;
}

.match input {
  width: 48px !important;
  height: 38px !important;
  font-size: 18px !important;
  font-weight: bold;
  text-align: center;
  color: #000 !important;
}

#final .match {
  background-color: #fff176 !important;
  color: #000;
  border: 2px solid #fff;
  box-shadow: 0 0 10px #fdd835;
}
#campeon {
  margin-top: 10px;
  font-size: 24px;
  color: #00e676;
  font-weight: bold;
}
#trophy {
  margin-top: 10px;
  max-width: 100px;
  display: block;
  margin-left: auto;
  margin-right: auto;
}

#octavosIzq .match, #octavosDer .match {
  background-color: #81d4fa !important;
  color: #000;
  border: 2px solid #fff;
  box-shadow: 0 0 6px #29b6f6;
}

#cuartosIzq .match, #cuartosDer .match {
  background-color: #aed581 !important;
  color: #000;
  border: 2px solid #fff;
  box-shadow: 0 0 6px #7cb342;
}

#semisIzq .match, #semisDer .match {
  background-color: #ffcc80 !important;
  color: #000;
  border: 2px solid #fff;
  box-shadow: 0 0 6px #ffa726;
}

    /* Fase eliminatoria en dorado */
    #octavosIzq .match,
    #octavosDer .match,
    #cuartosIzq .match,
    #cuartosDer .match,
    #semisIzq .match,
    #semisDer .match,
    #final .match {
      background: linear-gradient(to bottom, #fff8dc, #ffd700) !important;
      color: #000 !important;
      border: 2px solid #fff;
      box-shadow: 0 0 8px #ffd700;
      animation: goldGlow 2s ease-in-out infinite;
    }

    @keyframes goldGlow {
      0% { box-shadow: 0 0 6px #ffd700; }
      50% { box-shadow: 0 0 20px #ffc400; }
      100% { box-shadow: 0 0 6px #ffd700; }
    }

</style>
</head>
<body>
<h1>🏆 COPA WIOG – Mundial Visual con Llave Automática</h1>
<br/>
<h3>Agregar Equipos</h3>
<input id="equipoInput" placeholder="Nombre del equipo" type="text"/>
<button onclick="agregarEquipo()">Agregar</button><br/>
<textarea cols="40" id="listaEquipos" placeholder="" rows="6"></textarea><br/>
<button onclick="agregarLista()">Agregar Lista</button>
<div id="equiposAgregados" style="margin-top:10px; font-weight:bold;"></div>
<h3>💾 Guardar Torneo</h3>
<button onclick="guardarTorneo()">Guardar Estado</button>
<button onclick="cargarTorneo()">Cargar Estado</button>
<button onclick="sortearGrupos()">🎲 Sortear Grupos</button>
<div id="grupos"></div>
<hr/>
<h2>Fase Eliminatoria</h2>
<!-- Botón eliminado: clasificación automática habilitada -->
<div class="bracket">
<div class="round" id="octavosIzq"><div class="match"><span>Equipo 1</span><input min="0" type="number"/><span>Equipo 2</span><input min="0" type="number"/></div><div class="match"><span>Equipo 1</span><input min="0" type="number"/><span>Equipo 2</span><input min="0" type="number"/></div><div class="match"><span>Equipo 1</span><input min="0" type="number"/><span>Equipo 2</span><input min="0" type="number"/></div><div class="match"><span>Equipo 1</span><input min="0" type="number"/><span>Equipo 2</span><input min="0" type="number"/></div></div>
<div class="round" id="cuartosIzq"><div class="match"><span>Equipo 1</span><input min="0" type="number"/><span>Equipo 2</span><input min="0" type="number"/></div><div class="match"><span>Equipo 1</span><input min="0" type="number"/><span>Equipo 2</span><input min="0" type="number"/></div></div>
<div class="round" id="semisIzq"><div class="match"><span>Equipo 1</span><input min="0" type="number"/><span>Equipo 2</span><input min="0" type="number"/></div></div>
<div class="round" id="final"><div class="match"><span>Equipo 1</span><input min="0" type="number"/><span>Equipo 2</span><input min="0" type="number"/></div></div>
<div class="round" id="semisDer"><div class="match"><span>Equipo 1</span><input min="0" type="number"/><span>Equipo 2</span><input min="0" type="number"/></div></div>
<div class="round" id="cuartosDer"><div class="match"><span>Equipo 1</span><input min="0" type="number"/><span>Equipo 2</span><input min="0" type="number"/></div><div class="match"><span>Equipo 1</span><input min="0" type="number"/><span>Equipo 2</span><input min="0" type="number"/></div></div>
<div class="round" id="octavosDer"><div class="match"><span>Equipo 1</span><input min="0" type="number"/><span>Equipo 2</span><input min="0" type="number"/></div><div class="match"><span>Equipo 1</span><input min="0" type="number"/><span>Equipo 2</span><input min="0" type="number"/></div><div class="match"><span>Equipo 1</span><input min="0" type="number"/><span>Equipo 2</span><input min="0" type="number"/></div><div class="match"><span>Equipo 1</span><input min="0" type="number"/><span>Equipo 2</span><input min="0" type="number"/></div></div>
</div>
<div class="campeon" id="campeon"></div>

<script>
// ====== Champions League WIOG (36 equipos, 8 jornadas, con marcadores y tabla) ======
let CL_JUGADORES = [];
let CL_EQUIPOS = [];
let CL_PAREJAS = [];
let CL_MATCHUPS = new Map();

function cl_normalizarLista(texto) {
  return texto.split('
').map(s => s.trim()).filter(Boolean);
}
function cl_unicos(lista) {
  const set = new Set();
  const out = [];
  for (const item of lista) {
    const key = item.toLowerCase();
    if (!set.has(key)) { set.add(key); out.push(item); }
  }
  return out;
}
function cl_renderEstado() {
  const j = document.getElementById('cl-jugadores-estado');
  const e = document.getElementById('cl-equipos-estado');
  j.textContent = `Jugadores cargados (${CL_JUGADORES.length}/36): ${CL_JUGADORES.join(', ')}`;
  e.textContent = `Equipos cargados (${CL_EQUIPOS.length}/36): ${CL_EQUIPOS.join(', ')}`;
}
function cl_agregarJugadores() {
  const raw = document.getElementById('cl-jugadores-input').value;
  const lista = cl_unicos(cl_normalizarLista(raw));
  if (lista.length !== 36) { alert('Debes ingresar exactamente 36 jugadores.'); return; }
  CL_JUGADORES = lista; cl_renderEstado();
}
function cl_agregarEquipos() {
  const raw = document.getElementById('cl-equipos-input').value;
  const lista = cl_unicos(cl_normalizarLista(raw));
  if (lista.length !== 36) { alert('Debes ingresar exactamente 36 equipos.'); return; }
  CL_EQUIPOS = lista; cl_renderEstado();
}
function cl_sortearParejas() {
  if (CL_JUGADORES.length !== 36 || CL_EQUIPOS.length !== 36) { alert('Primero carga 36 jugadores y 36 equipos.'); return; }
  const jugadores = [...CL_JUGADORES].sort(() => Math.random() - 0.5);
  const equipos = [...CL_EQUIPOS].sort(() => Math.random() - 0.5);
  CL_PAREJAS = jugadores.map((jugador, i) => ({ jugador, equipo: equipos[i] }));
  const cont = document.getElementById('cl-parejas');
  cont.innerHTML = '<div class="cl-card"><h3>🔗 Parejas sorteadas</h3><div class="cl-grid" id="cl-grid-parejas"></div></div>';
  const grid = document.getElementById('cl-grid-parejas');
  CL_PAREJAS.forEach(p => {
    const div = document.createElement('div');
    div.className = 'cl-card';
    div.innerHTML = `<strong>${p.jugador}</strong> ⇄ <span style="color:#ffd700; font-weight:700;">${p.equipo}</span>`;
    grid.appendChild(div);
  });
}
function cl_initOpponents() {
  CL_MATCHUPS = new Map();
  for (const p of CL_PAREJAS) {
    CL_MATCHUPS.set(p.equipo, new Set());
  }
}

function cl_generarFaseLiga() {
  if (CL_PAREJAS.length !== 36) {
    alert('Primero genera las parejas.');
    return;
  }
  cl_initOpponents();

  const teams = CL_PAREJAS.map(p => p.equipo);
  const jornadas = [];
  const MAX_INTENTOS_RONDA = 2000;

  for (let r = 1; r <= 8; r++) {
    let rondasOk = false;
    let intentos = 0;
    let pairings = [];

    while (!rondasOk && intentos < MAX_INTENTOS_RONDA) {
      intentos++;
      pairings = [];
      const disponibles = [...teams].sort(() => Math.random() - 0.5);

      let valido = true;
      while (disponibles.length > 0) {
        const a = disponibles.shift();
        let emparejado = false;
        for (let i = 0; i < disponibles.length; i++) {
          const b = disponibles[i];
          if (!CL_MATCHUPS.get(a).has(b)) {
            pairings.push([a, b]);
            CL_MATCHUPS.get(a).add(b);
            CL_MATCHUPS.get(b).add(a);
            disponibles.splice(i, 1);
            emparejado = true;
            break;
          }
        }
        if (!emparejado) {
          for (const [x, y] of pairings) {
            CL_MATCHUPS.get(x).delete(y);
            CL_MATCHUPS.get(y).delete(x);
          }
          valido = false;
          break;
        }
      }
      if (valido) rondasOk = true;
    }

    if (!rondasOk) {
      cl_initOpponents();
      r = 0;
      jornadas.length = 0;
      continue;
    }
    jornadas.push(pairings);
  }

  // Render de jornadas con inputs de goles
  const cont = document.getElementById('cl-fixtures');
  cont.innerHTML = '';
  const jugadorPorEquipo = new Map(CL_PAREJAS.map(p => [p.equipo, p.jugador]));

  jornadas.forEach((pairs, idx) => {
    const roundDiv = document.createElement('div');
    roundDiv.className = 'cl-round';
    roundDiv.innerHTML = `<h4>Jornada ${idx + 1}</h4>`;
    const table = document.createElement('table');
    table.className = 'cl-table';
    const thead = document.createElement('thead');
    thead.innerHTML = '<tr><th>Local</th><th></th><th></th><th>Visitante</th><th>Jugador (Local)</th><th>Jugador (Visitante)</th></tr>';
    const tbody = document.createElement('tbody');

    pairs.forEach(([home, away], i) => {
      const tr = document.createElement('tr');
      tr.setAttribute('data-home', home);
      tr.setAttribute('data-away', away);
      const jl = jugadorPorEquipo.get(home) || '';
      const jv = jugadorPorEquipo.get(away) || '';
      const idh = `cl-r${idx+1}-m${i+1}-h`;
      const ida = `cl-r${idx+1}-m${i+1}-a`;
      tr.innerHTML = `<td>${home}</td>
                      <td><input id="${idh}" type="number" min="0" style="width:60px; text-align:center"/></td>
                      <td><input id="${ida}" type="number" min="0" style="width:60px; text-align:center"/></td>
                      <td>${away}</td>
                      <td>${jl}</td>
                      <td>${jv}</td>`;
      tbody.appendChild(tr);
    });

    table.appendChild(thead);
    table.appendChild(tbody);
    roundDiv.appendChild(table);
    cont.appendChild(roundDiv);
  });

  // Botón para calcular tabla y contenedor
  const btnWrap = document.createElement('div');
  btnWrap.style.marginTop = '14px';
  btnWrap.innerHTML = '<button id="cl-calcular-tabla">📊 Calcular Tabla de Liga</button>';
  cont.appendChild(btnWrap);

  const tablaDiv = document.createElement('div');
  tablaDiv.id = 'cl-tabla-liga';
  tablaDiv.style.marginTop = '12px';
  cont.appendChild(tablaDiv);

  const btnCalc = document.getElementById('cl-calcular-tabla');
  if (btnCalc) btnCalc.addEventListener('click', cl_calcularTablaLiga);

  document.getElementById('cl-generar-fase').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function cl_calcularTablaLiga() {
  if (CL_PAREJAS.length !== 36) {
    alert('Primero genera las parejas.');
    return;
  }
  const jugadorPorEquipo = new Map(CL_PAREJAS.map(p => [p.equipo, p.jugador]));
  // init stats
  const equipos = CL_PAREJAS.map(p => p.equipo);
  const stats = {};
  equipos.forEach(eq => {
    stats[eq] = {Equipo:eq, Jugador:(jugadorPorEquipo.get(eq)||''), PJ:0, PG:0, PE:0, PP:0, GF:0, GC:0, DG:0, Pts:0};
  });

  // Read every row with data-home / data-away and two inputs
  document.querySelectorAll('tr[data-home][data-away]').forEach(tr => {
    const home = tr.getAttribute('data-home');
    const away = tr.getAttribute('data-away');
    const inputs = tr.querySelectorAll('input[type="number"]');
    if (inputs.length < 2) return;
    const gh = parseInt(inputs[0].value);
    const ga = parseInt(inputs[1].value);
    if (Number.isNaN(gh) || Number.isNaN(ga)) return; // skip if incomplete

    // update stats
    stats[home].PJ++; stats[away].PJ++;
    stats[home].GF += gh; stats[home].GC += ga;
    stats[away].GF += ga; stats[away].GC += gh;

    if (gh > ga) { // home win
      stats[home].PG++; stats[away].PP++; stats[home].Pts += 3;
    } else if (gh < ga) { // away win
      stats[away].PG++; stats[home].PP++; stats[away].Pts += 3;
    } else { // draw
      stats[home].PE++; stats[away].PE++; stats[home].Pts += 1; stats[away].Pts += 1;
    }
  });

  // compute DG
  equipos.forEach(eq => { stats[eq].DG = stats[eq].GF - stats[eq].GC; });

  // sort: Pts DESC, DG DESC, GF DESC, Equipo ASC
  const tabla = Object.values(stats).sort((a,b) => (
    b.Pts - a.Pts || b.DG - a.DG || b.GF - a.GF || a.Equipo.localeCompare(b.Equipo)
  ));

  // render
  const cont = document.getElementById('cl-tabla-liga');
  if (!cont) return;
  let html = '<div class="cl-round"><h4>Tabla de Liga (parcial)</h4>';
  html += '<table class="cl-table"><thead><tr><th>#</th><th>Equipo</th><th>Jugador</th><th>PJ</th><th>PG</th><th>PE</th><th>PP</th><th>GF</th><th>GC</th><th>DG</th><th>Pts</th></tr></thead><tbody>';
  tabla.forEach((t, i) => {
    const top = i < 8 ? ' style="background:#b9fbc0;"' : '';
    html += `<tr${top}><td>${i+1}</td><td>${t.Equipo}</td><td>${t.Jugador}</td><td>${t.PJ}</td><td>${t.PG}</td><td>${t.PE}</td><td>${t.PP}</td><td>${t.GF}</td><td>${t.GC}</td><td>${t.DG}</td><td>${t.Pts}</td></tr>`;
  });
  html += '</tbody></table></div>';
  cont.innerHTML = html;
}

  cl_initOpponents();
  const teams = CL_PAREJAS.map(p => p.equipo);
  const jornadas = [];
  for (let r = 1; r <= 8; r++) {
    let pairings = [];
    const disponibles = [...teams].sort(() => Math.random() - 0.5);
    while (disponibles.length > 0) {
      const a = disponibles.shift();
      const b = disponibles.pop();
      pairings.push([a, b]);
    }
    jornadas.push(pairings);
  }
  const cont = document.getElementById('cl-fixtures');
  cont.innerHTML = '';
  jornadas.forEach((pairs, idx) => {
    const roundDiv = document.createElement('div');
    roundDiv.className = 'cl-round';
    roundDiv.innerHTML = `<h4>Jornada ${idx+1}</h4>`;
    const table = document.createElement('table');
    table.className = 'cl-table';
    const thead = document.createElement('thead');
    thead.innerHTML = '<tr><th>Local</th><th>Visitante</th><th>Jugador Local</th><th>Jugador Visitante</th><th>Goles Local</th><th>Goles Visitante</th></tr>';
    const tbody = document.createElement('tbody');
    const jugadorPorEquipo = new Map(CL_PAREJAS.map(p => [p.equipo, p.jugador]));
    pairs.forEach(([home, away], mi) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${home}</td><td>${away}</td><td>${jugadorPorEquipo.get(home)}</td><td>${jugadorPorEquipo.get(away)}</td>
      <td><input type="number" min="0" id="score-${idx}-${mi}-home" style="width:50px;"></td>
      <td><input type="number" min="0" id="score-${idx}-${mi}-away" style="width:50px;"></td>`;
      tbody.appendChild(tr);
    });
    table.appendChild(thead); table.appendChild(tbody);
    roundDiv.appendChild(table);
    cont.appendChild(roundDiv);
  });
  const btnTabla = document.createElement('button');
  btnTabla.textContent = '📊 Generar Tabla de Posiciones';
  btnTabla.onclick = cl_generarTablaPosiciones;
  cont.appendChild(btnTabla);
}
function cl_generarTablaPosiciones() {
  const stats = {};
  CL_PAREJAS.forEach(p => stats[p.equipo] = {Equipo:p.equipo, Jugador:p.jugador, PJ:0, G:0, E:0, P:0, GF:0, GC:0, DG:0, Pts:0});
  const cont = document.getElementById('cl-fixtures');
  const tables = cont.querySelectorAll('table');
  tables.forEach((table, ridx) => {
    const rows = table.querySelectorAll('tbody tr');
    rows.forEach((row, mi) => {
      const tds = row.querySelectorAll('td');
      const home = tds[0].innerText; const away = tds[1].innerText;
      const sh = parseInt(row.querySelector(`#score-${ridx}-${mi}-home`).value);
      const sa = parseInt(row.querySelector(`#score-${ridx}-${mi}-away`).value);
      if (isNaN(sh)||isNaN(sa)) return;
      stats[home].PJ++; stats[away].PJ++;
      stats[home].GF+=sh; stats[home].GC+=sa;
      stats[away].GF+=sa; stats[away].GC+=sh;
      if (sh>sa){ stats[home].G++; stats[away].P++; stats[home].Pts+=3; }
      else if (sh<sa){ stats[away].G++; stats[home].P++; stats[away].Pts+=3; }
      else { stats[home].E++; stats[away].E++; stats[home].Pts++; stats[away].Pts++; }
    });
  });
  Object.values(stats).forEach(s => s.DG = s.GF - s.GC);
  const tabla = Object.values(stats).sort((a,b)=>b.Pts-a.Pts||b.DG-a.DG||b.GF-a.GF);
  let html = '<h3>📊 Tabla de Posiciones</h3><table class="cl-table"><tr><th>Pos</th><th>Equipo</th><th>Jugador</th><th>PJ</th><th>G</th><th>E</th><th>P</th><th>GF</th><th>GC</th><th>DG</th><th>Pts</th></tr>';
  tabla.forEach((t,i)=>{
    html += `<tr><td>${i+1}</td><td>${t.Equipo}</td><td>${t.Jugador}</td><td>${t.PJ}</td><td>${t.G}</td><td>${t.E}</td><td>${t.P}</td><td>${t.GF}</td><td>${t.GC}</td><td>${t.DG}</td><td>${t.Pts}</td></tr>`;
  });
  html += '</table>';
  const tablaDiv = document.createElement('div');
  tablaDiv.innerHTML = html;
  cont.appendChild(tablaDiv);
}
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('cl-agregar-jugadores').addEventListener('click', cl_agregarJugadores);
  document.getElementById('cl-agregar-equipos').addEventListener('click', cl_agregarEquipos);
  document.getElementById('cl-sortear-parejas').addEventListener('click', cl_sortearParejas);
  document.getElementById('cl-generar-fase').addEventListener('click', cl_generarFaseLiga);
});


// ====== Marcadores por partido + Tabla de Posiciones (CL) ======
let CL_RESULTADOS = new Map(); // key: `${ronda}-${home}-${away}`, value: {gh, ga}

function cl_makeScoreInput(roundIdx, matchIdx, side, home, away) {
  const id = `cl-r${roundIdx+1}-m${matchIdx+1}-${side}`;
  const inp = document.createElement('input');
  inp.type = 'number';
  inp.min = '0';
  inp.className = 'cl-score';
  inp.id = id;
  inp.dataset.round = (roundIdx+1).toString();
  inp.dataset.home = home;
  inp.dataset.away = away;
  inp.dataset.side = side;
  inp.addEventListener('change', cl_onScoreChange);
  return inp;
}

function cl_onScoreChange(e) {
  const inp = e.target;
  const round = parseInt(inp.dataset.round);
  const home = inp.dataset.home;
  const away = inp.dataset.away;
  const side = inp.dataset.side;
  const key = `${round}-${home}-${away}`;

  const current = CL_RESULTADOS.get(key) || { gh: null, ga: null };
  if (side === 'home') current.gh = inp.value === '' ? null : parseInt(inp.value);
  else current.ga = inp.value === '' ? null : parseInt(inp.value);
  CL_RESULTADOS.set(key, current);

  if (current.gh !== null && current.ga !== null) {
    cl_calcularTabla();
  }
}

function cl_recolectarResultados() {
  const res = [];
  for (const [key, v] of CL_RESULTADOS.entries()) {
    if (v && Number.isInteger(v.gh) && Number.isInteger(v.ga)) {
      const [roundStr, home, away] = key.split('-');
      res.push({ round: parseInt(roundStr), home, away, gh: v.gh, ga: v.ga });
    }
  }
  return res;
}

function cl_calcularTabla() {
  if (CL_PAREJAS.length !== 36) return;
  const teams = CL_PAREJAS.map(p => p.equipo);
  const stats = new Map();
  for (const t of teams) {
    stats.set(t, { Equipo: t, PJ:0, PG:0, PE:0, PP:0, GF:0, GC:0, DG:0, Pts:0 });
  }

  const resultados = cl_recolectarResultados();
  resultados.forEach(({home, away, gh, ga}) => {
    const sh = stats.get(home);
    const sa = stats.get(away);
    if (!sh || !sa) return;
    sh.PJ++; sa.PJ++;
    sh.GF += gh; sh.GC += ga;
    sa.GF += ga; sa.GC += gh;
    if (gh > ga) { sh.PG++; sa.PP++; sh.Pts += 3; }
    else if (gh < ga) { sa.PG++; sh.PP++; sa.Pts += 3; }
    else { sh.PE++; sa.PE++; sh.Pts += 1; sa.Pts += 1; }
  });

  for (const s of stats.values()) s.DG = s.GF - s.GC;

  const table = Array.from(stats.values()).sort((a,b) =>
    (b.Pts - a.Pts) || (b.DG - a.DG) || (b.GF - a.GF) || a.Equipo.localeCompare(b.Equipo)
  );

  const cont = document.getElementById('cl-standings');
  if (!cont) return;
  cont.innerHTML = '';
  const tbl = document.createElement('table');
  tbl.className = 'cl-table';
  const thead = document.createElement('thead');
  thead.innerHTML = '<tr><th>#</th><th>Equipo</th><th>PJ</th><th>PG</th><th>PE</th><th>PP</th><th>GF</th><th>GC</th><th>DG</th><th>Pts</th></tr>';
  const tbody = document.createElement('tbody');
  table.forEach((row, idx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${idx+1}</td><td>${row.Equipo}</td><td>${row.PJ}</td><td>${row.PG}</td><td>${row.PE}</td><td>${row.PP}</td><td>${row.GF}</td><td>${row.GC}</td><td>${row.DG}</td><td><strong>${row.Pts}</strong></td>`;
    tbody.appendChild(tr);
  });
  tbl.appendChild(thead);
  tbl.appendChild(tbody);
  cont.appendChild(tbl);
}

</script>


</body>
</html>
