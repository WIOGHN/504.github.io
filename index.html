<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Champions League WIOG - Standalone</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif;background:#0e0e0e;color:#eee;line-height:1.4;margin:20px}
  h2,h3,h4{color:#ffd700;margin:8px 0}
  button{background:#1f1f1f;color:#ffd700;border:1px solid #ffd70055;border-radius:10px;padding:8px 12px;cursor:pointer}
  button:hover{filter:brightness(1.1)}
  textarea{width:100%;max-width:520px;background:#0e0e0e;color:#eee;border:1px solid #444;border-radius:8px;padding:8px}
  .cl-card { background:#121212; border:1px solid #ffd70055; border-radius:12px; padding:10px; margin:10px 0; }
  .cl-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:10px; }
  .cl-table { width:100%; border-collapse:collapse; }
  .cl-table th, .cl-table td { border:1px solid #444; padding:6px; background:#fff; color:#000; }
  .cl-table th { background:#ffd700; color:#000; }
  .cl-round { margin:16px 0; box-shadow:0 0 8px rgba(0,0,0,0.3); border-radius:10px; overflow:hidden; }
  .cl-round h4 { background:#303030; color:#ffd700; padding:8px 10px; margin:0; }
  .cl-top8 tr { background-color:#c8f7c5 !important; }
  .cl-playin tr { background-color:#fff3cd !important; }
  .cl-elim tr { background-color:#f8f9fa !important; }
  .cl-tie { display:flex; flex-direction:column; gap:6px; min-width:280px; border:1px dashed #444; padding:8px; border-radius:8px; margin:6px 0; }
  .cl-leg { background:#ffffff; color:#000; padding:6px; border-radius:6px; }
  .cl-agg { font-weight:bold; color:#111; background:#fffbe6; padding:6px; border-radius:6px; border:1px solid #ffd24d; }
  .bracket{ display:grid; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); gap:8px; }
</style>
</head>
<body>
<h2>🏟️ Champions League WIOG (Standalone)</h2>

<h3>👥 Agregar 36 Jugadores</h3>
<textarea id="cl-jugadores-input" rows="8" placeholder="Un jugador por línea (36 líneas)"></textarea><br/>
<button id="cl-agregar-jugadores" onclick="(window.cl_agregarJugadores||window.cl_fallbackAddJugadores)()">Agregar lista de jugadores</button>
<div id="cl-jugadores-estado" style="margin-top:8px; font-weight:bold;"></div>

<h3>🏳️ Agregar 36 Equipos</h3>
<textarea id="cl-equipos-input" rows="8" placeholder="Un equipo por línea (36 líneas)"></textarea><br/>
<button id="cl-agregar-equipos" onclick="(window.cl_agregarEquipos||window.cl_fallbackAddEquipos)()">Agregar lista de equipos</button>
<div id="cl-equipos-estado" style="margin-top:8px; font-weight:bold;"></div>

<div style="margin-top:14px;">
  <button id="cl-sortear-parejas" onclick="(window.cl_sortearParejas||window.cl_fallbackSortearParejas)()">🎲 Sortear Parejas (Jugador ⇄ Equipo)</button>
</div>
<div id="cl-parejas" style="margin-top:12px;"></div>

<div style="margin-top:18px;">
  <button id="cl-generar-fase" onclick="(window.cl_generarFaseLiga||window.cl_fallbackGenerarFaseLiga)()">📅 Generar Fase de Liga – Champions League WIOG (36 equipos, 8 jornadas)</button>
</div>
<div id="cl-fixtures" style="margin-top:16px;"></div>

<button id="cl-actualizar-tabla" onclick="(window.cl_actualizarTabla||window.cl_fallbackActualizarTabla)()">📊 Generar/Actualizar Tabla (estilo Champions)</button>
<div id="cl-standings" style="margin-top:12px;"></div>

<div id="cl-playin-controls" style="margin-top:16px; display:flex; gap:8px; flex-wrap:wrap; justify-content:center;">
  <button id="cl-gen-playin" onclick="(window.cl_generarPlayin||window.cl_fallbackGenerarPlayin)()">🎟️ Generar Play‑in (9–24)</button>
  <button id="cl-gen-octavos" onclick="(window.cl_generarOctavos||window.cl_fallbackGenerarOctavos)()">🏆 Generar Octavos (1–8 vs ganadores play‑in)</button>
</div>
<div id="cl-playin" style="margin-top:12px;"></div>

<div id="cl-ko" style="margin-top:18px;">
  <h3>⚔️ Eliminatoria – Champions League WIOG</h3>

  <div id="cl-octavos"><h4>Octavos de Final</h4><div class="bracket">
    <!-- 8 ties, two legs -->
  </div></div>

  <div id="cl-cuartos"><h4>Cuartos de Final</h4><div class="bracket"></div></div>

  <div id="cl-semis"><h4>Semifinales</h4><div class="bracket"></div></div>

  <div id="cl-final"><h4>Gran Final</h4><div class="bracket">
    <div class="match cl-tie" id="cl-final-t0">
      <span class="cl-home">—</span> <input type="number" min="0" id="cl-final-t0-a">
      <span class="cl-away">—</span> <input type="number" min="0" id="cl-final-t0-b">
    </div>
  </div></div>
</div>

<script>
// === Core State ===
let CL_JUGADORES = [];
let CL_EQUIPOS = [];
let CL_PAREJAS = [];
let CL_MATCHUPS = new Map();
let CL_JORNADAS = [];
let CL_TABLA = [];

// === Helpers ===
function cl_normalizarLista(texto){ return texto.split('\\n').map(s=>s.trim()).filter(Boolean); }
function cl_unicos(lista){ const set=new Set(); const out=[]; for (const x of lista){ const k=x.toLowerCase(); if(!set.has(k)){ set.add(k); out.push(x);} } return out; }
function cl_renderEstado(){
  const j = document.getElementById('cl-jugadores-estado');
  const e = document.getElementById('cl-equipos-estado');
  if (j) j.innerHTML = `Jugadores cargados (<strong>${CL_JUGADORES.length}</strong>/36): ${CL_JUGADORES.join(', ')} ` + (CL_JUGADORES.length===36?'':` <span style="color:#ffeb3b;">(faltan ${36-CL_JUGADORES.length})</span>`);
  if (e) e.innerHTML = `Equipos cargados (<strong>${CL_EQUIPOS.length}</strong>/36): ${CL_EQUIPOS.join(', ')} ` + (CL_EQUIPOS.length===36?'':` <span style="color:#ffeb3b;">(faltan ${36-CL_EQUIPOS.length})</span>`);
}

// === Add Lists ===
function cl_agregarJugadores(){
  const ta = document.getElementById('cl-jugadores-input'); if (!ta){ alert('No se encontró el área de jugadores.'); return; }
  const lista = cl_unicos(cl_normalizarLista(ta.value));
  if (!lista.length){ alert('Ingresa al menos 1 jugador.'); return; }
  CL_JUGADORES = lista; cl_renderEstado();
}
function cl_agregarEquipos(){
  const ta = document.getElementById('cl-equipos-input'); if (!ta){ alert('No se encontró el área de equipos.'); return; }
  const lista = cl_unicos(cl_normalizarLista(ta.value));
  if (!lista.length){ alert('Ingresa al menos 1 equipo.'); return; }
  CL_EQUIPOS = lista; cl_renderEstado();
}

// === Draw Pairs ===
function cl_sortearParejas(){
  if (CL_JUGADORES.length !== 36 || CL_EQUIPOS.length !== 36){ alert('Primero carga 36 jugadores y 36 equipos.'); return; }
  const jugadores=[...CL_JUGADORES].sort(()=>Math.random()-0.5);
  const equipos=[...CL_EQUIPOS].sort(()=>Math.random()-0.5);
  CL_PAREJAS = jugadores.map((jug,i)=>({ jugador:jug, equipo:equipos[i] }));
  const cont = document.getElementById('cl-parejas');
  cont.innerHTML = '<div class="cl-card"><h3 style="margin:4px 0;">🔗 Parejas sorteadas</h3><div class="cl-grid" id="cl-grid-parejas"></div></div>';
  const grid = document.getElementById('cl-grid-parejas');
  CL_PAREJAS.forEach(p=>{ const d=document.createElement('div'); d.className='cl-card'; d.innerHTML=`<strong>${p.jugador}</strong> ⇄ <span style="color:#ffd700; font-weight:700;">${p.equipo}</span>`; grid.appendChild(d); });
}

// === League Phase (8 rounds) ===
function cl_initOpponents(){ CL_MATCHUPS = new Map(CL_PAREJAS.map(p=>[p.equipo, new Set()])); }
function cl_generarFaseLiga(){
  if (CL_PAREJAS.length !== 36){ alert('Genera primero las parejas.'); return; }
  cl_initOpponents();
  const teams = CL_PAREJAS.map(p=>p.equipo);
  const homeCount = new Map(teams.map(t=>[t,0]));
  const jornadas = [];
  for (let r=0;r<8;r++){
    let ok=false, intentos=0, pairings=[];
    while(!ok && intentos<2000){
      intentos++; pairings=[];
      const disp=[...teams].sort(()=>Math.random()-0.5);
      let valido=true;
      while(disp.length){
        const a=disp.shift(); let emp=false;
        for (let i=0;i<disp.length;i++){
          const b=disp[i];
          if (!CL_MATCHUPS.get(a).has(b)){
            pairings.push([a,b]);
            CL_MATCHUPS.get(a).add(b); CL_MATCHUPS.get(b).add(a);
            disp.splice(i,1); emp=true; break;
          }
        }
        if(!emp){ for (const [x,y] of pairings){ CL_MATCHUPS.get(x).delete(y); CL_MATCHUPS.get(y).delete(x);} valido=false; break; }
      }
      if (valido) ok=true;
    }
    if (!ok){ cl_initOpponents(); r=-1; jornadas.length=0; continue; }
    // balance home/away
    pairings = pairings.map(([home,away])=>{
      const hc=homeCount.get(home), ac=homeCount.get(away);
      if (hc - ac > 0){ homeCount.set(away,ac+1); return [away,home]; }
      else { homeCount.set(home,hc+1); return [home,away]; }
    });
    jornadas.push(pairings);
  }
  CL_JORNADAS = jornadas;
  // Render
  const cont=document.getElementById('cl-fixtures'); cont.innerHTML='';
  const jx=new Map(CL_PAREJAS.map(p=>[p.equipo,p.jugador]));
  jornadas.forEach((pairs, idx)=>{
    const roundDiv=document.createElement('div'); roundDiv.className='cl-round';
    roundDiv.innerHTML=`<h4>Jornada ${idx+1}</h4>`;
    const table=document.createElement('table'); table.className='cl-table';
    table.innerHTML='<thead><tr><th>Local</th><th>Visitante</th><th>Jugador (Local)</th><th>Jugador (Visitante)</th></tr></thead>';
    const tbody=document.createElement('tbody');
    pairs.forEach(([home,away], mIdx)=>{
      const jl=jx.get(home)||'', jv=jx.get(away)||'';
      const ida=`cl-r${idx+1}-m${mIdx}-a`, idb=`cl-r${idx+1}-m${mIdx}-b`;
      const tr=document.createElement('tr');
      tr.innerHTML = `<td>${home}<br/><input type='number' min='0' id='${ida}' style='width:56px;'></td>`+
                     `<td>${away}<br/><input type='number' min='0' id='${idb}' style='width:56px;'></td>`+
                     `<td>${jl}</td><td>${jv}</td>`;
      tbody.appendChild(tr);
    });
    table.appendChild(tbody); roundDiv.appendChild(table); cont.appendChild(roundDiv);
  });
}

// === Standings ===
function cl_actualizarTabla(){
  if (!CL_PAREJAS.length || !CL_JORNADAS.length){ alert('Genera parejas y la fase de liga primero.'); return; }
  const stats = {}; CL_PAREJAS.forEach(p=> stats[p.equipo]={Equipo:p.equipo, Jugador:p.jugador, PJ:0,G:0,E:0,P:0,GF:0,GC:0,DG:0,Pts:0});
  CL_JORNADAS.forEach((pairs,rIdx)=>{
    pairs.forEach(([home,away],mIdx)=>{
      const a=parseInt((document.getElementById(`cl-r${rIdx+1}-m${mIdx}-a`)||{}).value);
      const b=parseInt((document.getElementById(`cl-r${rIdx+1}-m${mIdx}-b`)||{}).value);
      if (Number.isNaN(a)||Number.isNaN(b)) return;
      stats[home].PJ++; stats[away].PJ++;
      stats[home].GF+=a; stats[home].GC+=b;
      stats[away].GF+=b; stats[away].GC+=a;
      if (a>b){ stats[home].G++; stats[away].P++; stats[home].Pts+=3; }
      else if (a<b){ stats[away].G++; stats[home].P++; stats[away].Pts+=3; }
      else { stats[home].E++; stats[away].E++; stats[home].Pts++; stats[away].Pts++; }
    });
  });
  Object.values(stats).forEach(s=> s.DG = s.GF - s.GC);
  CL_TABLA = Object.values(stats).sort((a,b)=> b.Pts-a.Pts || b.DG-a.DG || b.GF-a.GF || a.Equipo.localeCompare(b.Equipo));

  const cont=document.getElementById('cl-standings'); cont.innerHTML='';
  const mk=(rows,start)=>{ const t=document.createElement('table'); t.className='cl-table';
    t.innerHTML='<thead><tr><th>#</th><th>Equipo</th><th>Jugador</th><th>PJ</th><th>G</th><th>E</th><th>P</th><th>GF</th><th>GC</th><th>DG</th><th>Pts</th></tr></thead>';
    const tb=document.createElement('tbody'); rows.forEach((r,i)=>{ const tr=document.createElement('tr');
      tr.innerHTML=`<td>${start+i}</td><td>${r.Equipo}</td><td>${r.Jugador}</td><td>${r.PJ}</td><td>${r.G}</td><td>${r.E}</td><td>${r.P}</td><td>${r.GF}</td><td>${r.GC}</td><td>${r.DG}</td><td><strong>${r.Pts}</strong></td>`;
      tb.appendChild(tr); }); t.appendChild(tb); return t; };
  const w1=document.createElement('div'); w1.className='cl-round cl-top8'; w1.innerHTML='<h4>1–8 Clasificación directa</h4>'; w1.appendChild(mk(CL_TABLA.slice(0,8),1));
  const w2=document.createElement('div'); w2.className='cl-round cl-playin'; w2.innerHTML='<h4>9–24 Play-in</h4>'; w2.appendChild(mk(CL_TABLA.slice(8,24),9));
  const w3=document.createElement('div'); w3.className='cl-round cl-elim'; w3.innerHTML='<h4>25–36 Eliminados</h4>'; w3.appendChild(mk(CL_TABLA.slice(24,36),25));
  cont.appendChild(w1); cont.appendChild(w2); cont.appendChild(w3);
}

// === Play-in (two legs) ===
function cl_generarPlayin(){
  if (!CL_TABLA.length){ alert('Actualiza la tabla primero.'); return; }
  const A = CL_TABLA.slice(8,16).map(r=>r.Equipo);   // 9–16 cabezas
  const B = CL_TABLA.slice(16,24).map(r=>r.Equipo);  // 17–24 no cabezas
  const cont=document.getElementById('cl-playin');
  cont.innerHTML = '<div class="cl-round"><h4>Play‑in (9–24) – Ida y vuelta</h4></div>';
  const wrap = cont.querySelector('.cl-round');
  const table=document.createElement('table'); table.className='cl-playin-table';
  table.innerHTML='<thead><tr><th>Emparejamiento</th><th>Ida</th><th>Vuelta</th><th>Global</th><th>Ganador</th></tr></thead>';
  const tb=document.createElement('tbody');
  for (let i=0;i<8;i++){
    const seeded=A[i], unseeded=B[7-i];
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${seeded} (cabeza) vs ${unseeded}</td>`+
                   `<td>${unseeded} <input type="number" min="0" id="pl${i}-ida-a" style="width:56px;"> – <input type="number" min="0" id="pl${i}-ida-b" style="width:56px;"> ${seeded}</td>`+
                   `<td>${seeded} <input type="number" min="0" id="pl${i}-vta-a" style="width:56px;"> – <input type="number" min="0" id="pl${i}-vta-b" style="width:56px;"> ${unseeded}</td>`+
                   `<td id="pl${i}-global">—</td><td id="pl${i}-win">—</td>`;
    tb.appendChild(tr);
  }
  table.appendChild(tb); wrap.appendChild(table);

  for (let i=0;i<8;i++){
    const seeded=A[i], unseeded=B[7-i];
    const idaA=document.getElementById(`pl${i}-ida-a`), idaB=document.getElementById(`pl${i}-ida-b`);
    const vtaA=document.getElementById(`pl${i}-vta-a`), vtaB=document.getElementById(`pl${i}-vta-b`);
    const out=document.getElementById(`pl${i}-global`), win=document.getElementById(`pl${i}-win`);
    const recalc=()=>{
      const a1=parseInt(idaA.value), b1=parseInt(idaB.value), a2=parseInt(vtaA.value), b2=parseInt(vtaB.value);
      if ([a1,b1,a2,b2].some(Number.isNaN)){ out.textContent='—'; win.textContent='—'; return; }
      const golesSeeded = b1 + a2;  // seeded: visita en ida, local en vuelta
      const golesUnseed = a1 + b2;  // no cabeza: local ida, visita vuelta
      out.textContent = `${golesSeeded}–${golesUnseed}`;
      if (golesSeeded>golesUnseed) win.textContent=seeded;
      else if (golesSeeded<golesUnseed) win.textContent=unseeded;
      else win.textContent = prompt(`Empate ${seeded} vs ${unseeded}. Ganador por penales:`) || '—';
    };
    [idaA,idaB,vtaA,vtaB].forEach(el=> el && el.addEventListener('input', recalc));
  }
}

// === Two-leg connector (Octavos/Cuartos/Semis) ===
function cl_connectTwoLeg(prefix, count, onWinnersReady){
  const winners = new Array(count).fill('—');
  for (let i=0;i<count;i++){
    const tieId = `${prefix}-t${i}`;
    const idaA = document.getElementById(`${tieId}-ida-a`);
    const idaB = document.getElementById(`${tieId}-ida-b`);
    const vtaA = document.getElementById(`${tieId}-vta-a`);
    const vtaB = document.getElementById(`${tieId}-vta-b`);
    const g    = document.getElementById(`${tieId}-global`);
    const w    = document.getElementById(`${tieId}-win`);
    const home = document.querySelectorAll(`#${tieId} .cl-home`);
    const away = document.querySelectorAll(`#${tieId} .cl-away`);
    const recalc = () => {
      const a1 = parseInt(idaA?.value), b1 = parseInt(idaB?.value), a2 = parseInt(vtaA?.value), b2 = parseInt(vtaB?.value);
      if ([a1,b1,a2,b2].some(Number.isNaN)){ if (g) g.textContent='—'; if (w) w.textContent='—'; winners[i]='—'; return; }
      const teamHomeIda = home[0]?.textContent || '—';
      const teamAwayIda = away[0]?.textContent || '—';
      const totalTeamA = a1 + b2; // local en ida + visitante en vuelta
      const totalTeamB = b1 + a2; // visitante en ida + local en vuelta
      if (g) g.textContent = `${totalTeamA}–${totalTeamB}`;
      let winner = '—';
      if (totalTeamA > totalTeamB) winner = teamHomeIda;
      else if (totalTeamB > totalTeamA) winner = teamAwayIda;
      else winner = prompt(`Empate ${teamHomeIda} vs ${teamAwayIda}. Ganador por penales:`) || '—';
      if (w) w.textContent = winner;
      winners[i] = winner;
      if (winners.every(x => x && x !== '—')) onWinnersReady([...winners]);
    };
    [idaA,idaB,vtaA,vtaB].forEach(el => el && el.addEventListener('input', recalc));
    // calcular por si ya hay datos
    recalc();
  }
}

// === Build bracket containers ===
function cl_buildKO(){
  function buildRound(roundId, ties, twoLeg=true){
    const sec=document.getElementById(roundId);
    const br=sec.querySelector('.bracket'); br.innerHTML='';
    for (let i=0;i<ties;i++){
      const card=document.createElement('div'); card.className='match cl-tie'; card.id=`${roundId}-t${i}`;
      if (twoLeg){
        const leg1=document.createElement('div'); leg1.className='cl-leg'; leg1.append('Ida: ');
        const h1=document.createElement('span'); h1.className='cl-home'; h1.textContent='—';
        const a1=document.createElement('input'); a1.type='number'; a1.min='0'; a1.id=`${roundId}-t${i}-ida-a`;
        const v1=document.createElement('span'); v1.className='cl-away'; v1.textContent='—';
        const b1=document.createElement('input'); b1.type='number'; b1.min='0'; b1.id=`${roundId}-t${i}-ida-b`;
        leg1.append(h1,' ',a1,' – ',b1,' ',v1);

        const leg2=document.createElement('div'); leg2.className='cl-leg'; leg2.append('Vuelta: ');
        const h2=document.createElement('span'); h2.className='cl-home'; h2.textContent='—'; // en vuelta: invierte localía
        const a2=document.createElement('input'); a2.type='number'; a2.min='0'; a2.id=`${roundId}-t${i}-vta-a`;
        const v2=document.createElement('span'); v2.className='cl-away'; v2.textContent='—';
        const b2=document.createElement('input'); b2.type='number'; b2.min='0'; b2.id=`${roundId}-t${i}-vta-b`;
        leg2.append(h2,' ',a2,' – ',b2,' ',v2);

        const agg=document.createElement('div'); agg.className='cl-agg';
        agg.innerHTML = `Global: <span id="${roundId}-t${i}-global">—</span>  Ganador: <span id="${roundId}-t${i}-win">—</span>`;

        card.append(leg1,leg2,agg);
      } else {
        const h=document.createElement('span'); h.className='cl-home'; h.textContent='—';
        const ia=document.createElement('input'); ia.type='number'; ia.min='0'; ia.id=`${roundId}-t${i}-a`;
        const v=document.createElement('span'); v.className='cl-away'; v.textContent='—';
        const ib=document.createElement('input'); ib.type='number'; ib.min='0'; ib.id=`${roundId}-t${i}-b`;
        card.append(h,ia,v,ib);
      }
      br.append(card);
    }
  }
  buildRound('cl-octavos',8,true);
  buildRound('cl-cuartos',4,true);
  buildRound('cl-semis',2,true);
  // final ya existe
}
cl_buildKO();

// === Generate Octavos and connect progression ===
function cl_generarOctavos(){
  if (!CL_TABLA.length){ alert('Actualiza la tabla primero.'); return; }
  // leer ganadores play-in
  const winners=[];
  for (let i=0;i<8;i++){
    const el=document.getElementById(`pl${i}-win`);
    if (!el || !el.textContent || el.textContent==='—'){ alert('Completa los ganadores del play‑in.'); return; }
    winners.push(el.textContent);
  }
  const top8 = CL_TABLA.slice(0,8).map(r=>r.Equipo);
  const shuffled = winners.slice().sort(()=>Math.random()-0.5);

  // poblar octavos
  for (let i=0;i<8;i++){
    const tie=document.getElementById(`cl-octavos-t${i}`);
    const homes=tie.querySelectorAll('.cl-home');
    const aways=tie.querySelectorAll('.cl-away');
    // ida: winner en casa; vuelta: cabeza de serie en casa
    homes[0].textContent = shuffled[i];
    aways[0].textContent = top8[i];
    homes[1].textContent = top8[i];
    aways[1].textContent = shuffled[i];
    ['ida-a','ida-b','vta-a','vta-b'].forEach(suf=>{ const inp=tie.querySelector(`#cl-octavos-t${i}-${suf}`); if (inp) inp.value=''; });
    const g=tie.querySelector(`#cl-octavos-t${i}-global`); if (g) g.textContent='—';
    const w=tie.querySelector(`#cl-octavos-t${i}-win`); if (w) w.textContent='—';
  }

  // conectar octavos -> cuartos
  cl_connectTwoLeg('cl-octavos', 8, (w8)=>{
    // armar cuartos
    for (let i=0;i<4;i++){
      const A=w8[2*i], B=w8[2*i+1];
      const tie=document.getElementById(`cl-cuartos-t${i}`);
      const homes=tie.querySelectorAll('.cl-home');
      const aways=tie.querySelectorAll('.cl-away');
      homes[0].textContent=A; aways[0].textContent=B;
      homes[1].textContent=B; aways[1].textContent=A;
      ['ida-a','ida-b','vta-a','vta-b'].forEach(suf=>{ const el=tie.querySelector(`#cl-cuartos-t${i}-${suf}`); if (el) el.value=''; });
      tie.querySelector(`#cl-cuartos-t${i}-global`).textContent='—';
      tie.querySelector(`#cl-cuartos-t${i}-win`).textContent='—';
    }
    // conectar cuartos -> semis
    cl_connectTwoLeg('cl-cuartos', 4, (w4)=>{
      for (let i=0;i<2;i++){
        const A=w4[2*i], B=w4[2*i+1];
        const tie=document.getElementById(`cl-semis-t${i}`);
        const homes=tie.querySelectorAll('.cl-home');
        const aways=tie.querySelectorAll('.cl-away');
        homes[0].textContent=A; aways[0].textContent=B;
        homes[1].textContent=B; aways[1].textContent=A;
        ['ida-a','ida-b','vta-a','vta-b'].forEach(suf=>{ const el=tie.querySelector(`#cl-semis-t${i}-${suf}`); if (el) el.value=''; });
        tie.querySelector(`#cl-semis-t${i}-global`).textContent='—';
        tie.querySelector(`#cl-semis-t${i}-win`).textContent='—';
      }
      // conectar semis -> final
      cl_connectTwoLeg('cl-semis', 2, (w2)=>{
        const f=document.getElementById('cl-final-t0');
        const sp=f.querySelectorAll('span');
        sp[0].textContent = w2[0];
        sp[1].textContent = w2[1];
        document.getElementById('cl-final-t0-a').value='';
        document.getElementById('cl-final-t0-b').value='';
      });
    });
  });
}

// === Minimal fallbacks in case core not found (onclick calls already use these when needed) ===
window.cl_fallbackAddJugadores = cl_agregarJugadores;
window.cl_fallbackAddEquipos = cl_agregarEquipos;
window.cl_fallbackSortearParejas = cl_sortearParejas;
window.cl_fallbackGenerarFaseLiga = cl_generarFaseLiga;
window.cl_fallbackActualizarTabla = cl_actualizarTabla;
window.cl_fallbackGenerarPlayin = cl_generarPlayin;
window.cl_fallbackGenerarOctavos = cl_generarOctavos;
</script>
</body>
</html>
